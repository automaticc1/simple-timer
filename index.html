<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⏳</text></svg>">
  <style>
    :root { --gap: 1rem; --font: 'Inter', sans-serif; --bg: #f0f4f8; --fg: #222; }
    * { box-sizing: border-box; }
    body { margin: 0; height: 100vh; font-family: var(--font); display: flex; background: linear-gradient(180deg, #f4f9ff 0%, #fdfdfd 100%); }
    .pane { padding: var(--gap); overflow-y: auto; }
    #tasks { width: 35%; background: #fff; border-right: 1px solid #ddd; }
    #timer-pane { flex: 1; display: flex; flex-direction: column; }
    h2 { margin-top: 0; }
    /* Summary & schedule */
    #summary { font-weight: bold; margin-bottom: var(--gap); }
    #schedule { display: flex; align-items: center; gap: 0.5rem; margin-bottom: var(--gap); }
    #finish-time { margin-left: var(--gap); font-weight: 600; }
    form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    form input { flex: 1; padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; }
    form button { padding: 0.5em 1em; border: none; background: #007bff; color: #fff; border-radius: 4px; cursor: pointer; }
    ul { list-style: none; padding: 0; margin: 0; }
    li { display: flex; align-items: center; gap: 0.5rem; padding: 0.5em; margin-bottom: 0.25em; background: var(--bg); border-radius: 8px; cursor: grab; }
    li.dragging { opacity: 0.5; }
    .task-name { flex: 2; }
    .task-est { width: 60px; text-align: right; }
    .btn { border: none; background: none; padding: 0.2em; cursor: pointer; font-size: 1em; }
    .btn.edit, .btn.delete { color: #666; opacity: 0.6; }
    .btn.edit:hover, .btn.delete:hover { opacity: 1; }
    .btn.start { background: #28a745; color: #fff; border-radius: 4px; padding: 0.3em 0.6em; font-size: 1em; }
    .btn.start:hover { opacity: 0.9; }
    .btn-group { margin-left: auto; display: flex; gap: 0.5em; }

    .main { flex: 1; display: flex; justify-content: center; align-items: center; }
    .timer-display { font-size: 6rem; font-weight: 600; color: var(--fg); text-align: center; }
    .controls { padding: var(--gap); display: flex; flex-direction: column; align-items: center; gap: 1rem; }
    .neumorphic-input { display: flex; align-items: center; background: var(--bg); border-radius: 16px; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.03), inset -2px -2px 5px rgba(255,255,255,0.8); padding: 0.8rem 1.2rem; width: 220px; }
    .neumorphic-input input { border: none; background: transparent; font-size: 1.2rem; width: 100%; text-align: center; outline: none; color: #333; }
    .button-row { display: flex; gap: 1rem; margin-top: 0.5rem; }
    .icon-btn { background: var(--bg); border: none; padding: 0.75rem; font-size: 1.3rem; border-radius: 16px; box-shadow: 4px 4px 12px rgba(0,0,0,0.08), -4px -4px 12px rgba(255,255,255,0.9); cursor: pointer; transition: all 0.2s ease; width: 3.5rem; height: 3.5rem; display: flex; justify-content: center; align-items: center; }
    .icon-btn:active { box-shadow: inset 2px 2px 6px rgba(0,0,0,0.05), inset -2px -2px 6px rgba(255,255,255,0.8); }
    .icon-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .icon-btn[title] { position: relative; }
    .icon-btn[title]:hover::after { content: attr(title); position: absolute; bottom: -1.8rem; background: #444; color: #fff; font-size: 0.7rem; padding: 2px 6px; border-radius: 6px; white-space: nowrap; opacity: 0.9; }
  </style>
</head>
<body>
  <div id="tasks" class="pane">
    <h2>Tasks</h2>
    <div id="summary">Total: 0h 0m</div>
    <div id="schedule">
      <label for="start-time">Start Time:</label>
      <input type="time" id="start-time">
      <span id="finish-time"></span>
    </div>
    <form id="task-form">
      <input id="name-input" type="text" placeholder="Task name" required>
      <input id="est-input" type="number" placeholder="Est. min" min="0" required>
      <button type="submit">Add</button>
    </form>
    <ul id="task-list"></ul>
  </div>
  <div id="timer-pane" class="pane">
    <div class="main"><div id="timer" class="timer-display">00:00</div></div>
    <div class="controls">
      <div class="neumorphic-input"><input id="minutesInput" type="number" placeholder="Enter minutes" min="0" step="0.1"></div>
      <div class="button-row">
        <button id="startBtn" class="icon-btn" title="Start">▶</button>
        <button id="pauseBtn" class="icon-btn" title="Pause" disabled>⏸</button>
        <button id="resetBtn" class="icon-btn" title="Reset">⟲</button>
      </div>
    </div>
    <audio id="endSound" src="timer-end.mp3" preload="auto"></audio>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const STORAGE_KEY = 'taskTimer.tasks';
      let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      const taskForm = document.getElementById('task-form');
      const nameIn = document.getElementById('name-input');
      const estIn = document.getElementById('est-input');
      const list = document.getElementById('task-list');
      const summaryEl = document.getElementById('summary');
      const startTimeInput = document.getElementById('start-time');
      const finishEl = document.getElementById('finish-time');
      
      function saveTasks() { localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }
      function formatHoursMins(total) {
        const h = Math.floor(total/60), m = total%60;
        return `${h}h ${m}m`;
      }
      function updateSummary() {
        const total = tasks.reduce((sum,t)=>sum+t.est,0);
        summaryEl.textContent = `Total: ${formatHoursMins(total)}`;
        // calculate finish
        const startVal = startTimeInput.value;
        if (startVal) {
          const [sh, sm] = startVal.split(':').map(Number);
          const now = new Date(); now.setHours(sh,sm,0,0);
          const finish = new Date(now.getTime() + total*60000);
          const fh = String(finish.getHours()).padStart(2,'0');
          const fm = String(finish.getMinutes()).padStart(2,'0');
          finishEl.textContent = `Finish at ${fh}:${fm}`;
        } else {
          finishEl.textContent = '';
        }
      }
      function renderTasks() {
        list.innerHTML = '';
        tasks.forEach((t,i)=>{
          const li = document.createElement('li'); li.draggable=true; li.dataset.index=i;
          li.addEventListener('dragstart', e=>{li.classList.add('dragging'); e.dataTransfer.setData('text/plain',i);});
          li.addEventListener('dragend', ()=>li.classList.remove('dragging'));
          li.addEventListener('dragover', e=>{
            e.preventDefault(); const over=e.target.closest('li'); if(!over||over===li) return;
            const from=parseInt(e.dataTransfer.getData('text/plain'),10);
            const to=parseInt(over.dataset.index,10);
            tasks.splice(to,0,tasks.splice(from,1)[0]); saveTasks(); renderTasks(); updateSummary();
          });
          const nameSpan=document.createElement('span'); nameSpan.textContent=t.name; nameSpan.className='task-name';
          const estSpan=document.createElement('span'); estSpan.textContent=`${t.est} min`; estSpan.className='task-est';
          const btnGrp=document.createElement('div'); btnGrp.className='btn-group';
          const editBtn=document.createElement('button'); editBtn.textContent='✎'; editBtn.className='btn edit';
          editBtn.addEventListener('click',()=>{ const n=prompt('Name:',t.name), e=prompt('Est (min):',t.est); if(n!==null) t.name=n.trim(); const num=parseInt(e,10); if(!isNaN(num)) t.est=num; saveTasks(); renderTasks(); updateSummary(); });
          const delBtn=document.createElement('button'); delBtn.textContent='✕'; delBtn.className='btn delete';
          delBtn.addEventListener('click',()=>{ tasks.splice(i,1); saveTasks(); renderTasks(); updateSummary(); });
          const startBtnTask=document.createElement('button'); startBtnTask.textContent='▶'; startBtnTask.className='btn start';
          startBtnTask.addEventListener('click',()=>{ minutesInput.value=t.est; startTimer(); });
          btnGrp.append(editBtn,delBtn,startBtnTask);
          li.append(nameSpan,estSpan,btnGrp); list.appendChild(li);
        });
        updateSummary();
      }
      taskForm.addEventListener('submit', e=>{ e.preventDefault(); tasks.push({name:nameIn.value.trim(),est:parseInt(estIn.value,10)||0}); saveTasks(); renderTasks(); taskForm.reset(); nameIn.focus(); });

      // Timer Logic
      let remainingSeconds=0, timerId=null, isPaused=false;
      const originalTitle=document.title;
      const timerDisplay=document.getElementById('timer');
      const minutesInput=document.getElementById('minutesInput');
      const startBtn=document.getElementById('startBtn');
      const pauseBtn=document.getElementById('pauseBtn');
      const resetBtn=document.getElementById('resetBtn');
      const endSound=document.getElementById('endSound');
      function formatTime(s){const m=String(Math.floor(s/60)).padStart(2,'0'), sec=String(s%60).padStart(2,'0'); return `${m}:${sec}`;}
      function updateDisplay(){timerDisplay.textContent=formatTime(remainingSeconds); document.title=remainingSeconds>0?formatTime(remainingSeconds):originalTitle;}
      function playBeep(){try{endSound.currentTime=0; endSound.play();}catch{}}
      function tick(){ if(remainingSeconds<=0){clearInterval(timerId); timerId=null; updateDisplay(); playBeep(); toggleInputs(true);} else{remainingSeconds--; updateDisplay();}}      
      function toggleInputs(enable){ minutesInput.disabled=!enable; startBtn.disabled=!enable; pauseBtn.disabled=enable; resetBtn.disabled=enable; }
      function startTimer(){const mins=parseFloat(minutesInput.value); if(isNaN(mins)||mins<=0){alert('Enter positive minutes');return;} remainingSeconds=Math.ceil(mins*60); updateDisplay(); isPaused=false; toggleInputs(false); timerId=setInterval(tick,1000);}
      function pauseTimer(){ if(!isPaused){clearInterval(timerId); isPaused=true; pauseBtn.textContent='▶';} else{timerId=setInterval(tick,1000); isPaused=false; pauseBtn.textContent='⏸';}}      
      function resetTimer(){clearInterval(timerId); timerId=null; remainingSeconds=0; updateDisplay(); document.title=originalTitle; isPaused=false; pauseBtn.textContent='⏸'; toggleInputs(true);}
      function startWithEstimate(est){ minutesInput.value=est; startTimer(); }
      startBtn.addEventListener('click',startTimer);
      pauseBtn.addEventListener('click',pauseTimer);
      resetBtn.addEventListener('click',resetTimer);
      minutesInput.addEventListener('keypress',e=>{if(e.key==='Enter')startTimer();});

      // Init
      renderTasks(); updateDisplay();

      // Update summary when start time changes
      startTimeInput.addEventListener('change', updateSummary);
    });
  </script>
</body>
</html>
